{"version":3,"file":"index.js","sources":["../src/utils/throttle.ts","../src/ScrollSpy/ScrollSpy.tsx"],"sourcesContent":["export const throttle = (callback: () => void, limit: number) => {\n  var tick = false;\n\n  return () => {\n    if (!tick) {\n      callback();\n      tick = true;\n      setTimeout(function () {\n        tick = false;\n      }, limit);\n    }\n  };\n};\n","import * as React from \"react\";\nimport {\n  MutableRefObject,\n  ReactNode,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { throttle } from \"../utils/throttle\";\n\ninterface ScrollSpyProps {\n  children: ReactNode;\n\n  // refs\n  navContainerRef?: MutableRefObject<HTMLDivElement | null>;\n  parentScrollContainerRef?: MutableRefObject<HTMLDivElement | null>;\n\n  // throttle\n  scrollThrottle?: number;\n\n  // callback\n  onUpdateCallback?: (id: string) => void;\n\n  // offsets\n  offsetTop?: number;\n  offsetBottom?: number;\n\n  // customize attributes\n  useDataAttribute?: string;\n  activeClass?: string;\n\n  useBoxMethod?: boolean;\n  updateHistoryStack?: boolean;\n}\n\nconst ScrollSpy = ({\n  children,\n\n  // refs\n  navContainerRef,\n  parentScrollContainerRef,\n\n  // throttle\n  scrollThrottle = 300,\n\n  // callback\n  onUpdateCallback,\n\n  // offsets\n  offsetTop = 0,\n  offsetBottom = 0,\n\n  // customize attributes\n  useDataAttribute = \"to-scrollspy-id\",\n  activeClass = \"active-scroll-spy\",\n\n  useBoxMethod = true,\n  updateHistoryStack = true,\n}: ScrollSpyProps) => {\n  const scrollContainerRef = useRef<HTMLDivElement | null>(null);\n  const [navContainerItems, setNavContainerItems] = useState<NodeListOf<Element> | undefined>(); // prettier-ignore\n\n  // keeps track of the Id in navcontainer which is active\n  // so as to not update classLists unless it has been updated\n  const prevIdTracker = useRef(\"\");\n\n  // To get the nav container items depending on whether the parent ref for the nav container is passed or not\n  useEffect(() => {\n    navContainerRef\n      ? setNavContainerItems(\n          navContainerRef.current?.querySelectorAll(\n            `[data-${useDataAttribute}]`\n          )\n        )\n      : setNavContainerItems(\n          document.querySelectorAll(`[data-${useDataAttribute}]`)\n        );\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [navContainerRef]);\n\n  // fire once after nav container items are set\n  useEffect(() => {\n    checkAndUpdateActiveScrollSpy();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [navContainerItems]);\n\n  const isVisible = (el: HTMLElement) => {\n    const rectInView = el.getBoundingClientRect();\n\n    if (useBoxMethod) {\n      const useHeight = parentScrollContainerRef?.current\n        ? parentScrollContainerRef?.current.offsetHeight\n        : window.innerHeight;\n      const hitbox_top = useHeight;\n      const element_top = rectInView.top;\n      const element_bottom = rectInView.top + useHeight;\n\n      return (\n        hitbox_top < element_bottom + offsetBottom &&\n        hitbox_top > element_top - offsetTop\n      );\n    } else {\n      // this decides how much of the element should be visible\n      const leniency = parentScrollContainerRef?.current\n        ? parentScrollContainerRef?.current.offsetHeight * 0.5\n        : window.innerHeight * 0.5;\n\n      const useHeight = parentScrollContainerRef?.current\n        ? parentScrollContainerRef?.current.offsetHeight\n        : window.innerHeight;\n\n      return (\n        rectInView.top + leniency + offsetTop >= 0 &&\n        rectInView.bottom - leniency - offsetBottom <= useHeight\n      );\n    }\n  };\n\n  const checkAndUpdateActiveScrollSpy = () => {\n    const scrollParentContainer = scrollContainerRef.current;\n\n    // if there are no children, return\n    if (!(scrollParentContainer && navContainerItems)) return;\n\n    // loop over all children in scroll container\n    for (let i = 0; i < scrollParentContainer.children.length; i++) {\n      // get child element\n      const useChild = scrollParentContainer.children.item(i) as HTMLDivElement;\n\n      const elementIsVisible = isVisible(useChild);\n\n      // check if the element is in the viewport\n      if (elementIsVisible) {\n        // if so, get its ID\n        const changeHighlightedItemId = useChild.id;\n\n        // if the element was same as the one currently active ignore it\n        if (prevIdTracker.current === changeHighlightedItemId) return;\n\n        // now loop over each element in the nav Container\n        navContainerItems.forEach((el) => {\n          const attrId = el.getAttribute(`data-${useDataAttribute}`);\n\n          // if the element contains 'active' the class remove it\n          if (el.classList.contains(activeClass)) {\n            el.classList.remove(activeClass);\n          }\n\n          // check if its ID matches the ID we got from the viewport\n          // also make sure it does not already contain the 'active' class\n          if (\n            attrId === changeHighlightedItemId &&\n            !el.classList.contains(activeClass)\n          ) {\n            el.classList.add(activeClass);\n\n            if (onUpdateCallback) {\n              onUpdateCallback(changeHighlightedItemId);\n            }\n\n            prevIdTracker.current = changeHighlightedItemId;\n            if (updateHistoryStack) {\n              window.history.replaceState(\n                {},\n                \"\",\n                `#${changeHighlightedItemId}`\n              );\n            }\n          }\n        });\n        break;\n      }\n    }\n  };\n\n  useEffect(() => {\n    // listen for scroll event\n    parentScrollContainerRef\n      ? // if ref for scrollable div is provided\n        parentScrollContainerRef.current?.addEventListener(\n          \"scroll\",\n          throttle(checkAndUpdateActiveScrollSpy, scrollThrottle)\n        )\n      : // else listen for scroll in window\n        window.addEventListener(\n          \"scroll\",\n          throttle(checkAndUpdateActiveScrollSpy, scrollThrottle)\n        );\n  });\n\n  return <div ref={scrollContainerRef}>{children}</div>;\n};\n\nexport default ScrollSpy;\n"],"names":["useRef","useState","useEffect","React"],"mappings":"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"}